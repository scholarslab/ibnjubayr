(function(e){var h=document,i="parent,top,opener,frameElement,frames,localStorage,globalStorage,sessionStorage,indexedDB".split(","),j="open,close,openDialog,showModalDialog,alert,confirm,prompt,openDatabase,postMessage,XMLHttpRequest,XDomainRequest".split(","),k=["referrer","write","open","close"];e.dom.Sandbox=Base.extend({constructor:function(b,a){this.callback=b||e.EMPTY_FUNCTION;this.config=e.lang.object({}).merge(a).get();this.iframe=this._createIframe()},insertInto:function(b){typeof b==="string"&&
(b=h.getElementById(b));b.appendChild(this.iframe)},getIframe:function(){return this.iframe},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var b=this.getIframe();b.parentNode.removeChild(b)},_readyError:function(){throw Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet");},_createIframe:function(){var b=this,a=h.createElement("iframe");a.className="wysihtml5-sandbox";e.dom.setAttributes({security:"restricted",allowtransparency:"true",
frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(a);if(e.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty())a.src="javascript:'<html></html>'";a.onload=function(){a.onreadystatechange=a.onload=null;b._onLoadIframe(a)};a.onreadystatechange=function(){if(/loaded|complete/.test(a.readyState))a.onreadystatechange=a.onload=null,b._onLoadIframe(a)};return a},_onLoadIframe:function(b){if(e.dom.contains(h.documentElement,b)){var a=this,f=b.contentWindow,d=b.contentWindow.document,c=this._getHtml({charset:h.characterSet||
h.charset||"utf-8",stylesheets:this.config.stylesheets});d.open("text/html","replace");d.write(c);d.close();this.getWindow=function(){return b.contentWindow};this.getDocument=function(){return b.contentWindow.document};f.onerror=function(a,b,c){throw Error("wysihtml5.Sandbox: "+a,b,c);};if(!e.browser.supportsSandboxedIframes()){var g;for(c=0,g=i.length;c<g;c++)this._unset(f,i[c]);for(c=0,g=j.length;c<g;c++)this._unset(f,j[c],e.EMPTY_FUNCTION);for(c=0,g=k.length;c<g;c++)this._unset(d,k[c]);this._unset(d,
"cookie","",!0)}this.loaded=!0;setTimeout(function(){a.callback(a)},0)}},_getHtml:function(b){var a=b.stylesheets,f="",d=0,c;if(a=typeof a==="string"?[a]:a)for(c=a.length;d<c;d++)f+='<link rel="stylesheet" href="'+a[d]+'">';b.stylesheets=f;return e.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(b)},_unset:function(b,a,f,d){try{b[a]=f}catch(c){}try{b.__defineGetter__(a,function(){return f})}catch(g){}if(d)try{b.__defineSetter__(a,
function(){})}catch(h){}if(!e.browser.crashesWhenDefineProperty(a))try{var i={get:function(){return f}};if(d)i.set=function(){};Object.defineProperty(b,a,i)}catch(j){}}})})(wysihtml5);
