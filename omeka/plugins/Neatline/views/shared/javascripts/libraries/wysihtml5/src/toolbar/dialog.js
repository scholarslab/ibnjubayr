(function(f){var e=f.dom;f.toolbar.Dialog=f.lang.Dispatcher.extend({constructor:function(a,b){this.link=a;this.container=b},_observe:function(){if(!this._observed){var a=this,b=function(b){var c=a._serialize();c==a.elementToChange?a.fire("edit",c):a.fire("save",c);a.hide();b.preventDefault();b.stopPropagation()};e.observe(a.link,"click",function(){e.hasClass(a.link,"wysihtml5-command-dialog-opened")&&setTimeout(function(){a.hide()},0)});e.observe(this.container,"keydown",function(c){var d=c.keyCode;
d===f.ENTER_KEY&&b(c);d===f.ESCAPE_KEY&&a.hide()});e.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",b);e.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(b){a.fire("cancel");a.hide();b.preventDefault();b.stopPropagation()});for(var c=this.container.querySelectorAll("input, select, textarea"),d=0,h=c.length,i=function(){clearInterval(a.interval)};d<h;d++)e.observe(c[d],"change",i);this._observed=!0}},_serialize:function(){for(var a=this.elementToChange||
{},b=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"),c=b.length,d=0;d<c;d++)a[b[d].getAttribute("data-wysihtml5-dialog-field")]=b[d].value;return a},_interpolate:function(a){for(var b,c,d=document.querySelector(":focus"),e=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"),f=e.length,g=0;g<f;g++)if(b=e[g],b!==d&&!(a&&b.type==="hidden"))c=b.getAttribute("data-wysihtml5-dialog-field"),c=this.elementToChange?this.elementToChange[c]||"":b.defaultValue,b.value=c},show:function(a){var b=
this,c=this.container.querySelector("input, select, textarea");this.elementToChange=a;this._observe();this._interpolate();if(a)this.interval=setInterval(function(){b._interpolate(!0)},500);e.addClass(this.link,"wysihtml5-command-dialog-opened");this.container.style.display="";this.fire("show");if(c&&!a)try{c.focus()}catch(d){}},hide:function(){clearInterval(this.interval);this.elementToChange=null;e.removeClass(this.link,"wysihtml5-command-dialog-opened");this.container.style.display="none";this.fire("hide")}})})(wysihtml5);
