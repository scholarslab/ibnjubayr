wysihtml5.browser.supportsCommand(document,"insertHTML")&&(module("wysihtml5.UndoManager",{setup:function(){this.textareaElement=document.createElement("textarea");this.textareaElement.value="1";document.body.appendChild(this.textareaElement)},teardown:function(){for(var b;b=document.querySelector("iframe.wysihtml5-sandbox, input[name='_wysihtml5_mode']");)b.parentNode.removeChild(b);document.body.removeChild(this.textareaElement)},triggerUndo:function(b){this.triggerKey(b,90)},triggerRedo:function(b){this.triggerKey(b,
89)},triggerKey:function(b,a){var c;try{c=b.composer.sandbox.getDocument().createEvent("KeyEvents"),c.initKeyEvent("keydown",!0,!0,b.composer.sandbox.getWindow(),!0,!1,!1,!1,a,a)}catch(d){c=b.composer.sandbox.getDocument().createEvent("Events"),c.initEvent("keydown",!0,!0),c.ctrlKey=!0,c.keyCode=a}b.composer.element.dispatchEvent(c)}}),asyncTest("Basic test",function(){expect(5);var b=this,a=new wysihtml5.Editor(this.textareaElement);a.on("load",function(){a.setValue("1 2").fire("newword:composer");
a.setValue("1 2 3").fire("newword:composer");a.setValue("1 2 3 4").fire("newword:composer");a.setValue("1 2 3 4 5");b.triggerUndo(a);equal(a.getValue(),"1 2 3 4");b.triggerRedo(a);b.triggerRedo(a);equal(a.getValue(),"1 2 3 4 5");b.triggerUndo(a);b.triggerUndo(a);equal(a.getValue(),"1 2 3");b.triggerUndo(a);b.triggerUndo(a);equal(a.getValue(),"1");b.triggerUndo(a);b.triggerUndo(a);equal(a.getValue(),"1");start()})}),asyncTest("Test commands",function(){expect(3);var b=this,a=new wysihtml5.Editor(this.textareaElement);
a.on("load",function(){a.setValue("<b>1</b>").fire("beforecommand:composer");a.setValue("<i><b>1</b></i>").fire("beforecommand:composer");b.triggerUndo(a);equal(a.getValue(),"<b>1</b>");b.triggerRedo(a);equal(a.getValue(),"<i><b>1</b></i>");b.triggerUndo(a);b.triggerUndo(a);equal(a.getValue(),"1");start()})}));
