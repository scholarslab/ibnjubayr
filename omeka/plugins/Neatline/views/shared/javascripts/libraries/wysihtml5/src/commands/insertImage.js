(function(d){d.commands.insertImage={exec:function(a,b,c){var c=typeof c==="object"?c:{src:c},f=a.doc,b=this.state(a),e;if(b)a.selection.setBefore(b),c=b.parentNode,c.removeChild(b),d.dom.removeEmptyTextNodes(c),c.nodeName==="A"&&!c.firstChild&&(a.selection.setAfter(c),c.parentNode.removeChild(c)),d.quirks.redraw(a.element);else{b=f.createElement("IMG");for(e in c)b[e]=c[e];a.selection.insertNode(b);d.browser.hasProblemsSettingCaretAfterImg()?(c=f.createTextNode(d.INVISIBLE_SPACE),a.selection.insertNode(c),
a.selection.setAfter(c)):a.selection.setAfter(b)}},state:function(a){var b;if(!d.dom.hasElementWithTagName(a.doc,"IMG"))return!1;b=a.selection.getSelectedNode();if(!b)return!1;if(b.nodeName==="IMG")return b;if(b.nodeType!==d.ELEMENT_NODE)return!1;b=a.selection.getText();if(b=d.lang.string(b).trim())return!1;a=a.selection.getNodes(d.ELEMENT_NODE,function(a){return a.nodeName==="IMG"});return a.length!==1?!1:a[0]},value:function(a){return(a=this.state(a))&&a.src}}})(wysihtml5);
