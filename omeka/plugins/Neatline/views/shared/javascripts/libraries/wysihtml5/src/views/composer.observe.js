(function(f){var b=f.dom,g=f.browser,l={66:"bold",73:"italic",85:"underline"};f.views.Composer.prototype.observe=function(){var c=this,h=this.getValue(),i=this.sandbox.getIframe(),e=this.element,j=g.supportsEventsInIframeCorrectly()?e:this.sandbox.getWindow(),m=g.supportsEvent("drop")?["drop","paste"]:["dragdrop","paste"];b.observe(i,"DOMNodeRemoved",function(){clearInterval(k);c.parent.fire("destroy:composer")});var k=setInterval(function(){b.contains(document.documentElement,i)||(clearInterval(k),
c.parent.fire("destroy:composer"))},250);b.observe(j,"focus",function(){c.parent.fire("focus").fire("focus:composer");setTimeout(function(){h=c.getValue()},0)});b.observe(j,"blur",function(){h!==c.getValue()&&c.parent.fire("change").fire("change:composer");c.parent.fire("blur").fire("blur:composer")});f.browser.isIos()&&b.observe(e,"blur",function(){var a=e.ownerDocument.createElement("input"),d=document.documentElement.scrollTop||document.body.scrollTop,n=document.documentElement.scrollLeft||document.body.scrollLeft;
try{c.selection.insertNode(a)}catch(b){e.appendChild(a)}a.focus();a.parentNode.removeChild(a);window.scrollTo(n,d)});b.observe(e,"dragenter",function(){c.parent.fire("unset_placeholder")});g.firesOnDropOnlyWhenOnDragOverIsCancelled()&&b.observe(e,["dragover","dragenter"],function(a){a.preventDefault()});b.observe(e,m,function(a){var d=a.dataTransfer,b;d&&g.supportsDataTransfer()&&(b=d.getData("text/html")||d.getData("text/plain"));b?(e.focus(),c.commands.exec("insertHTML",b),c.parent.fire("paste").fire("paste:composer"),
a.stopPropagation(),a.preventDefault()):setTimeout(function(){c.parent.fire("paste").fire("paste:composer")},0)});b.observe(e,"keyup",function(a){a=a.keyCode;(a===f.SPACE_KEY||a===f.ENTER_KEY)&&c.parent.fire("newword:composer")});this.parent.observe("paste:composer",function(){setTimeout(function(){c.parent.fire("newword:composer")},0)});g.canSelectImagesInContentEditable()||b.observe(e,"mousedown",function(a){var d=a.target;d.nodeName==="IMG"&&(c.selection.selectNode(d),a.preventDefault())});b.observe(e,
"keydown",function(a){var d=l[a.keyCode];if((a.ctrlKey||a.metaKey)&&!a.altKey&&d)c.commands.exec(d),a.preventDefault()});b.observe(e,"keydown",function(a){var d=c.selection.getSelectedNode(!0),b=a.keyCode;if(d&&d.nodeName==="IMG"&&(b===f.BACKSPACE_KEY||b===f.DELETE_KEY))b=d.parentNode,b.removeChild(d),b.nodeName==="A"&&!b.firstChild&&b.parentNode.removeChild(b),setTimeout(function(){f.quirks.redraw(e)},0),a.preventDefault()});var o={IMG:"Image: ",A:"Link: "};b.observe(e,"mouseover",function(a){var a=
a.target,b=a.nodeName;!(b!=="A"&&b!=="IMG")&&!a.hasAttribute("title")&&(b=o[b]+(a.getAttribute("href")||a.getAttribute("src")),a.setAttribute("title",b))})}})(wysihtml5);
