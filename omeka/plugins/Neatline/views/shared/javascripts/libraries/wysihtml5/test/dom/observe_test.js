module("wysihtml5.dom.observe",{setup:function(){this.container=document.createElement("div");this.element=document.createElement("textarea");this.container.appendChild(this.element);document.body.appendChild(this.container)},teardown:function(){this.container.parentNode.removeChild(this.container);for(var a;a=document.querySelector("iframe.wysihtml5-sandbox");)a.parentNode.removeChild(a)}});
test("Basic test",function(){expect(4);var a=this.element;wysihtml5.dom.observe(a,["mouseover","mouseout"],function(a){ok(!0,"'"+a.type+"' correctly fired")});wysihtml5.dom.observe(a,"click",function(b){equal(b.target,a,"event.target or event.srcElement are set");ok(!0,"'click' correctly fired")});QUnit.triggerEvent(a,"mouseover");QUnit.triggerEvent(a,"mouseout");QUnit.triggerEvent(a,"click")});
test("Test stopPropagation and scope of event handler",function(){expect(2);var a=this.element;wysihtml5.dom.observe(this.container,"click",function(){ok(!1,"The event shouldn't have been bubbled!")});wysihtml5.dom.observe(this.element,"click",function(b){b.stopPropagation();equal(this,a,"Event handler bound to correct scope");ok(!0,"stopPropagation correctly fired")});QUnit.triggerEvent(this.element,"click")});
test("Test detaching events",function(){expect(0);wysihtml5.dom.observe(this.element,"click",function(){ok(!1,"This should not be triggered")}).stop();QUnit.triggerEvent(this.element,"click")});
asyncTest("Advanced test observing within a sandboxed iframe",function(){expect(2);var a=new wysihtml5.dom.Sandbox(function(){var b=a.getDocument().createElement("div");a.getDocument().body.appendChild(b);wysihtml5.dom.observe(b,["click","mousedown"],function(a){ok(!0,"'"+a.type+"' correctly fired")});QUnit.triggerEvent(b,"click");QUnit.triggerEvent(b,"mousedown");start()});a.insertInto(document.body)});
