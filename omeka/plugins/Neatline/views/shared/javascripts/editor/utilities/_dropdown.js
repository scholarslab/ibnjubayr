/*
     http://www.apache.org/licenses/LICENSE-2.0.html Apache 2 License
*/
(function(b){b.widget("neatline.nlDropdown",{options:{markup:{content:"div.dropdown-content",topbar:"#topbar"},css:{duration:400},radios:[]},_create:function(){this._body=b("body");this._window=b(window);this.topbar=b(this.options.markup.topbar);this.radios=this.options.radios;this.content=this.element.next(this.options.markup.content);this.content.detach();b("body").append(this.content);this._expanded=!1;this._measure();this._addEvents()},_measure:function(){this.contentWidth=this.content.width();
this.contentHeight=this.content.height();this.topbarHeight=this.topbar.height();this.buttonWidth=this.element.width()},_getOffsets:function(){this.buttonOffset=this.element.offset();this.topbarHeight=this.topbar.height()},_addEvents:function(){var a=this;this.element.bind({mousedown:function(){a._expanded?a.hide():a.show()},click:function(a){a.preventDefault()}});this._window.bind("resize",function(){a.position();a._trigger("resize")})},setRadioDropdowns:function(a){this.radios=a},position:function(){var a;
this._getOffsets();this._expanded?(a=this.topbarHeight,this.content.css({left:Math.max(0,this.buttonOffset.left+this.buttonWidth-this.contentWidth),top:a})):(a=this.contentHeight-this.topbarHeight,this.content.css({left:Math.max(0,this.buttonOffset.left+this.buttonWidth-this.contentWidth),top:-a}))},show:function(){if(_.isArray(this.radios)&&this.radios.length>0){var a=_.filter(this.radios,function(a){return a._expanded});this._createRadioSetHideCont(a,a.length,0)()}else this._show()},_createRadioSetHideCont:function(a,
b,c){var d=this;return function(){var e=c+1;c>=b?d._show():a[c].hide(d._createRadioSetHideCont(a,b,e))}},_show:function(){var a=this;this.position();this.content.css("display","block");this._trigger("showstart");this.content.stop().animate({top:this.topbarHeight},this.options.css.duration,function(){a._trigger("show")});this.element.addClass("open");this._expanded=!0},hide:function(a){var b=this;this.content.stop().animate({top:-this.contentHeight},this.options.css.duration,function(){b.content.css("display",
"none");b._trigger("hide");_.isFunction(a)&&a()});this.element.removeClass("open");this._expanded=!1}})})(jQuery);
