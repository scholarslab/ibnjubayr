/*
     http://www.apache.org/licenses/LICENSE-2.0.html Apache 2 License
*/
(function(b){b.widget("neatline.integerdragger",{options:{min:null,max:null,def:0,px_per_unit:5,tip:{show:!0,text:"click and drag",padding:10,"class":"intdragger-tooltip"}},_create:function(){this._body=b("body");this._window=b(window);this.currentVal=null;this.isDragging=!1;this._setStartingValue();this.options.tip.show&&this._buildToolTip();this._addEvents()},_buildToolTip:function(){this.tip=b("<span></span>").addClass(this.options.tip["class"]).text(this.options.tip.text).css("position","absolute");
this.tipHeight=this._measureToolTip();this.inputHeight=this.element.outerHeight(!1);this.inputWidth=this.element.outerWidth()},_addEvents:function(){var a=this;this.element.bind({mouseenter:function(){a.options.tip.show&&!a.isDragging&&a._showToolTip()},mouseleave:function(){a.options.tip.show&&!a.isDragging&&a._hideToolTip()},keyup:function(){a.element.val()!==""&&a._setInputValue(parseInt(a.element.val(),10))},mousedown:function(b){a.isDragging=!0;var c=b.pageY,d=parseInt(a.element.val(),10);a._window.bind({mousemove:function(b){a._setInputValue(d+
Math.round((c-b.pageY)/a.options.px_per_unit))},mouseup:function(){a.isDragging=!1;a._window.unbind("mousemove");a.options.tip.show&&a._hideToolTip()}})}})},_setStartingValue:function(){var a=this.element.val();isNaN(parseInt(a))?this._setInputValue(this.options.def):this._setInputValue(a)},_setInputValue:function(a){if(this.options.min!=null&&a<this.options.min)return this.element.val(this.options.min),this.currentVal=this.options.min,!1;else if(this.options.max!=null&&a>this.options.max)return this.element.val(this.options.max),
this.currentVal=this.options.max,!1;else if(_.isNaN(a))return this.element.val(this.options.def),this.currentVal=this.options.def,!1;this.element.val(a);this.currentVal=a;this._trigger("change",{},{value:this.currentVal});return!0},_measureToolTip:function(){this.tip.css({top:-1E3,left:-1E3}).appendTo(this._body);return this.tip.height()},_showToolTip:function(){var a=this.element.offset();this.tip.css({top:a.top+(this.inputHeight-this.tipHeight)/2,left:a.left+this.inputWidth+this.options.tip.padding,
opacity:0});this._body.append(this.tip);this.tip.animate({opacity:1},200)},_hideToolTip:function(){var a=this;this.tip.animate({opacity:0},200,function(){a.tip.remove()})}})})(jQuery);
