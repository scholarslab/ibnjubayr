/*
     http://www.apache.org/licenses/LICENSE-2.0.html Apache 2 License
*/
(function(a){a.widget("neatline.configurelayout",{_create:function(){this.saveArrangementButton=a("#save-arrangement");this.fixPositionsButton=a("#fix-positions");this.layoutBuilder=a("#configure-layout");this._constructDropdown();this._instantiateLayoutBuilder();this._addEvents()},_instantiateLayoutBuilder:function(){var b=this;this.layoutBuilder.layoutbuilder({widthDrag:function(a,d){b._trigger("widthDrag",{},d)}})},_addEvents:function(){var b=this;this.saveArrangementButton.bind({mousedown:function(){b.saveArrangement()}});
this.fixPositionsButton.bind({mousedown:function(){b._trigger("savepositions")}})},_constructDropdown:function(){this.element.nlDropdown({resize:_.bind(function(){this.layoutBuilder.layoutbuilder("getPxConstants");this.layoutBuilder.layoutbuilder("centerAllTags")},this),showstart:_.bind(function(){this.layoutBuilder.layoutbuilder("getPxConstants");this.layoutBuilder.layoutbuilder("centerAllTags")},this),show:_.bind(function(){this.layoutBuilder.layoutbuilder("getPxConstants");this.layoutBuilder.layoutbuilder("centerAllTags")},
this)})},setViewportProportions:function(b,a){this.layoutBuilder.layoutbuilder("applyProportions",b,a)},saveArrangement:function(){var b=this,c=this.layoutBuilder.layoutbuilder("getArrangementParameters");a.ajax({url:"ajax/arrangement",type:"POST",dataType:"json",data:c,success:function(a){b._trigger("newarrangement",{},{params:a})}})},savePositions:function(b,c,d,e,f){var g=this;a.ajax({url:"ajax/positions",type:"POST",data:{exhibit_id:Neatline.record.id,map_center:b,map_zoom:c,map_base_layer:d,
timeline_center:e,timeline_zoom:f},success:function(){g._trigger("newpositions")}})}})})(jQuery);
