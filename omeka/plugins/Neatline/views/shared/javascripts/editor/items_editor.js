/*
     http://www.apache.org/licenses/LICENSE-2.0.html Apache 2 License
*/
(function(c){c.widget("neatline.itemorderer",c.extend({},c.neatline.neatlineitems.prototype,{_create:function(){this._isOrdering=!1;this._dragId=null;return c.neatline.neatlineitems.prototype._create.apply(this,arguments)},_getRowOrder:function(){var b=this;this._order=[];var a=this.element.find(".item-title");c.each(a,function(a,f){f=c(f);b._order.push(parseInt(f.attr("recordid")))})},reorder:function(){_.isNull(this._currentRecord)||this.contractDescription(this._currentRecord);this.element.disableSelection();
this.__hideAllDescriptions();this._addOrderingEventsToItems();this._isOrdering=!0;this._getRowOrder()},endreorder:function(){this.__setPointerCursor();this._getItemOffsets();this._removeOrderingEventsToItems();this._isOrdering=!1;return this.objectifyOrder()},_addOrderingEventsToItems:function(){var b=this;b.__setMoveCursor();c.each(this.items,function(a,d){d=c(d);d.unbind("mousedown");d.bind("mousedown",function(){b._doItemDrag(d)})})},_removeOrderingEventsToItems:function(){c.each(this.items,function(b,
a){a=c(a);a.unbind("mousedown")});this.loadData()},_doItemDrag:function(b){var a=this,d=b.next("li.item-description");this._getRowOrder();this._dragId=parseInt(b.attr("recordid"));this.__fadeItem(b);c.each(this.items,function(f,e){var e=c(e),g=parseInt(e.attr("recordid")),h=e.next("li.item-description");e.bind({mouseenter:function(){g!=a._dragId&&(a._order.indexOf(g)<a._order.indexOf(a._dragId)?(b.detach().insertBefore(e),d.detach().insertAfter(b)):a._order.indexOf(g)>a._order.indexOf(a._dragId)&&
(b.detach().insertAfter(h),d.detach().insertAfter(b)));a._getRowOrder()}})});this._window.bind({mouseup:function(){a._endItemDrag(b)}})},_endItemDrag:function(b){this.__unfadeItem(b);this._window.unbind("mouseup");this.items.unbind("mouseenter")},__hideAllDescriptions:function(){c.each(this.items,function(b,a){a=c(a);a.next("li.item-description").css("display","none")})},__setMoveCursor:function(){c.each(this.items,function(b,a){c(a).css("cursor","move")})},__setPointerCursor:function(){c.each(this.items,
function(b,a){c(a).css("cursor","pointer")})},__fadeItem:function(b){b.css("opacity",0.4)},__unfadeItem:function(b){b.css("opacity",1)},__fadeItems:function(){this.items.animate({opacity:0.3},200)},__unfadeItems:function(){this.items.animate({opacity:1},200)},objectifyOrder:function(){var b={};c.each(this._order,function(a,c){b[c]=a});return b}}));c.neatline.neatlineitems.defaults=c.extend({},c.neatline.neatlineitems.defaults)})(jQuery);
